<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Warning System</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0b0f1a;
            --panel: #1e293b;
            --accent: #38bdf8;
            --danger: #ef4444;
            --warning: #fbbf24;
            --success: #10b981;
            --border: rgba(255,255,255,0.1);
            --glass: rgba(30,41,59,0.7);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; }

        header {
            height: 65px; background: var(--glass);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px;
        }

        .logo-box { display: flex; align-items: center; gap: 10px; font-weight: 800; letter-spacing: 1px; }
        .nav-links { display: flex; gap: 10px; }
        .nav-item {
            cursor: pointer; padding: 8px 16px; border-radius: 8px;
            color: #94a3b8; font-weight: 500; font-size: 0.85rem; transition: 0.3s;
        }
        .nav-item.active, .nav-item:hover { background: var(--accent); color: #0b0f1a; font-weight: 600; }

        .page { display: none; height: calc(100vh - 65px); padding: 20px; overflow-y: auto; }
        .page.active { display: grid; gap: 20px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .panel { background: var(--glass); border: 1px solid var(--border); border-radius: 16px; padding: 18px; display: flex; flex-direction: column; }
        .panel h3 { font-size: 0.9rem; text-transform: uppercase; color: var(--accent); margin-bottom: 15px; letter-spacing: 1px; }

        /* GRID LAYOUTS */
        #page-home { grid-template-columns: 320px 1fr 350px; }
        #page-analytics { grid-template-columns: 1fr 1fr; }
        #page-rescue { grid-template-columns: 1fr; }
        #page-directory { grid-template-columns: 1fr; }
        #page-weather { grid-template-columns: 1fr; }
        #page-awareness { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); align-content: start; }
        #page-history { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); align-content: start; }

        /* ANALYTICS UI */
        .analytics-stats { grid-column: span 2; display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; }
        .chart-container { background: var(--panel); border-radius: 16px; padding: 20px; border: 1px solid var(--border); height: 320px; position: relative; }
        
        /* TABLE UI */
        .dir-table { width: 100%; border-collapse: collapse; background: var(--panel); border-radius: 12px; overflow: hidden; }
        .dir-table th, .dir-table td { padding: 14px; text-align: left; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .dir-table th { background: rgba(255,255,255,0.05); color: var(--accent); text-transform: uppercase; font-size: 0.75rem; }

        .state-card {
            background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px;
            margin-bottom: 10px; border-left: 4px solid var(--accent); cursor: pointer; transition: 0.2s;
        }
        .state-card:hover { background: rgba(255,255,255,0.1); }

        .sos-btn {
            background: var(--danger); border: none; color: white;
            padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%;
            margin-top: auto; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        /* Weather Specific Pills */
        .aqi-pill { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }
        .aqi-good { background: rgba(16, 185, 129, 0.1); color: var(--success); border: 1px solid var(--success); }
        .aqi-mod { background: rgba(251, 191, 36, 0.1); color: var(--warning); border: 1px solid var(--warning); }
        .aqi-poor { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }

        /* Awareness Card Styling */
        .awareness-card { 
            background: linear-gradient(145deg, #1e293b, #0f172a); 
            border-radius: 20px; padding: 25px; border: 1px solid var(--border);
            transition: transform 0.3s ease; display: flex; flex-direction: column;
        }
        .awareness-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .awareness-card i { font-size: 2.5rem; color: var(--accent); margin-bottom: 20px; }
        .awareness-card h4 { font-size: 1.2rem; margin-bottom: 15px; color: var(--warning); text-transform: uppercase; }
        .awareness-section { margin-bottom: 15px; }
        .awareness-section h5 { font-size: 0.8rem; color: var(--accent); text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .awareness-card ul { list-style: none; font-size: 0.85rem; color: #cbd5e1; }
        .awareness-card li { margin-bottom: 6px; padding-left: 15px; position: relative; line-height: 1.4; }
        .awareness-card li::before { content: "→"; position: absolute; left: 0; color: var(--accent); }

        /* History Card Styling */
        .history-card { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 20px; display: flex; flex-direction: column; gap: 12px; transition: 0.3s; }
        .history-card:hover { border-color: var(--danger); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(239, 68, 68, 0.1); }
        .history-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
        .history-title { font-size: 1.1rem; color: white; font-weight: 600; margin-bottom: 5px;}
        .year-pill { background: rgba(239, 68, 68, 0.15); color: var(--danger); padding: 4px 10px; border-radius: 6px; font-weight: bold; font-size: 0.8rem; border: 1px solid rgba(239,68,68,0.3); }
        .history-desc { font-size: 0.85rem; color: #cbd5e1; line-height: 1.5; flex-grow: 1; }
        .history-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem; margin-top: auto; }
        .stat-box { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; }
        .stat-box span { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .stat-box b { color: var(--accent); }

        /* Map & Markers */
        #map { height: 100%; width: 100%; border-radius: 12px; }
        .custom-warning-icon { background: transparent !important; border: none !important; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo-box"><i class="fa-solid fa-satellite-dish" style="color:var(--accent)"></i>DISASTER WARNING DASHBOARD</div>

    <nav class="nav-links">
        <div class="nav-item active" onclick="showPage('page-home',this)">HOME</div>
        <div class="nav-item" onclick="showPage('page-weather',this)">WEATHER REPORT</div>
        <div class="nav-item" onclick="showPage('page-analytics',this)">DATA ANALYTICS</div>
        <div class="nav-item" onclick="showPage('page-rescue',this)">RESCUE OPS</div>
        <div class="nav-item" onclick="showPage('page-directory',this)">CONTACT</div>
        <div class="nav-item" onclick="showPage('page-history',this)">DISASTER ARCHIVES</div>
        <div class="nav-item" onclick="showPage('page-awareness',this)">AWARENESS</div>
    </nav>

    <span id="live-clock" style="color:var(--warning); font-family: monospace; font-weight: bold;"></span>
</header>

<div id="page-home" class="page active">
    <div class="panel">
        <h3>Threat Watch</h3>
        <div id="state-list" style="overflow-y: auto; flex: 1;"></div>
        <button class="sos-btn" onclick="triggerSOS()">INITIALIZE MASS ALERT</button>
    </div>

    <div class="panel" style="padding:0">
        <div id="map"></div>
    </div>

    <div class="panel">
        <h3>Live Intelligence Feed</h3>
        <div id="incident-feed" style="overflow-y: auto;"></div>
    </div>
</div>

<div id="page-weather" class="page">
    <div class="panel">
        <h3>National Meteorological Forecast</h3>
        <table class="dir-table" id="weatherForecastTable">
            <thead>
                <tr>
                    <th>State/UT</th>
                    <th>Temp (°C)</th>
                    <th>Rain %</th>
                    <th>Wind Speed</th>
                    <th>Wind Pattern</th>
                    <th>Humidity</th>
                    <th>Visibility</th>
                    <th>AQI</th>
                </tr>
            </thead>
            <tbody id="weather-body"></tbody>
        </table>
    </div>
</div>

<div id="page-analytics" class="page">
    <div class="analytics-stats">
        <div class="panel"><h4>Wind Speed</h4><h2 style="color:var(--warning)">82 km/h</h2></div>
        <div class="panel"><h4>River Level</h4><h2 style="color:var(--accent)">8.4 m</h2></div>
        <div class="panel"><h4>Flood Depth</h4><h2 style="color:var(--danger)">1.7 m</h2></div>
        <div class="panel"><h4>Pressure</h4><h2 style="color:var(--success)">986 hPa</h2></div>
        <div class="panel"><h4>Storm Surge</h4><h2 style="color:var(--danger)">3.2 m</h2></div>
    </div>

    <div class="chart-container"><h3>Wind Speed Trend</h3><canvas id="windChart"></canvas></div>
    <div class="chart-container"><h3>River Level Monitoring</h3><canvas id="riverChart"></canvas></div>
    <div class="chart-container"><h3>Flood Depth Trend</h3><canvas id="floodChart"></canvas></div>
    <div class="chart-container"><h3>Pressure Variation</h3><canvas id="pressureChart"></canvas></div>
    <div class="chart-container" style="grid-column: span 2;"><h3>Storm Surge (Coastal Analysis)</h3><canvas id="stormChart"></canvas></div>
</div>

<div id="page-rescue" class="page">
    <div class="panel">
        <h3><i class="fa-solid fa-map-location-dot"></i> Zonal Rescue Intelligence Matrix</h3>
        <table class="dir-table">
            <thead>
                <tr>
                    <th>Zone (India)</th>
                    <th>Active Teams (NDRF)</th>
                    <th>Evacuated (72h)</th>
                    <th>Relief Camps</th>
                    <th>Boats + Helis</th>
                    <th>Risk Status</th>
                </tr>
            </thead>
            <tbody id="rescue-zonal-body"></tbody>
        </table>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
        <div class="panel">
            <h3>Active Supply Drops</h3>
            <div id="supply-feed"></div>
        </div>
        <div class="panel">
            <h3>Field Comms Status</h3>
            <div id="comms-status"></div>
        </div>
    </div>
</div>

<div id="page-directory" class="page">
    <div class="panel">
        <h3>Emergency Contact Directory (National & State)</h3>
        <table class="dir-table">
            <thead>
                <tr><th>State / Region</th><th>Direct Contact</th><th>Status</th></tr>
            </thead>
            <tbody id="directory-body"></tbody>
        </table>
    </div>
</div>

<div id="page-history" class="page">
    <div class="history-card">
        <div class="history-header">
            <div>
                <div class="history-title"><i class="fa-solid fa-water" style="color:var(--accent); margin-right:5px;"></i> Indian Ocean Tsunami</div>
            </div>
            <span class="year-pill">2004</span>
        </div>
        <p class="history-desc">A massive undersea megathrust earthquake off the coast of Sumatra triggered devastating tsunamis across the Indian Ocean, severely impacting coastal India.</p>
        <div class="history-stats">
            <div class="stat-box"><span>Affected Areas</span> <b>TN, AP, Kerala, A&N Islands</b></div>
            <div class="stat-box"><span>Magnitude</span> <b style="color:var(--danger)">9.1 - 9.3 Mw</b></div>
        </div>
    </div>

    <div class="history-card">
        <div class="history-header">
            <div>
                <div class="history-title"><i class="fa-solid fa-house-crack" style="color:var(--accent); margin-right:5px;"></i> Gujarat Earthquake</div>
            </div>
            <span class="year-pill">2001</span>
        </div>
        <p class="history-desc">The Bhuj earthquake occurred on India's 52nd Republic Day, causing catastrophic destruction across the Kutch district and surrounding regions.</p>
        <div class="history-stats">
            <div class="stat-box"><span>Affected Areas</span> <b>Gujarat (Bhuj, Ahmedabad)</b></div>
            <div class="stat-box"><span>Magnitude</span> <b style="color:var(--danger)">7.7 Mw</b></div>
        </div>
    </div>

    <div class="history-card">
        <div class="history-header">
            <div>
                <div class="history-title"><i class="fa-solid fa-cloud-showers-water" style="color:var(--accent); margin-right:5px;"></i> North India Floods</div>
            </div>
            <span class="year-pill">2013</span>
        </div>
        <p class="history-desc">A multi-day cloudburst centered on the northern state of Uttarakhand caused devastating floods and landslides, becoming the country's worst natural disaster since the 2004 tsunami.</p>
        <div class="history-stats">
            <div class="stat-box"><span>Affected Areas</span> <b>Uttarakhand, Himachal</b></div>
            <div class="stat-box"><span>Primary Cause</span> <b style="color:var(--warning)">Cloudburst</b></div>
        </div>
    </div>

    <div class="history-card">
        <div class="history-header">
            <div>
                <div class="history-title"><i class="fa-solid fa-hurricane" style="color:var(--accent); margin-right:5px;"></i> Odisha Super Cyclone</div>
            </div>
            <span class="year-pill">1999</span>
        </div>
        <p class="history-desc">The most intense recorded tropical cyclone in the North Indian Ocean and among the most destructive in the region, bringing massive storm surges and winds.</p>
        <div class="history-stats">
            <div class="stat-box"><span>Affected Areas</span> <b>Odisha Coast</b></div>
            <div class="stat-box"><span>Wind Speed</span> <b style="color:var(--danger)">260 km/h</b></div>
        </div>
    </div>

    <div class="history-card">
        <div class="history-header">
            <div>
                <div class="history-title"><i class="fa-solid fa-tornado" style="color:var(--accent); margin-right:5px;"></i> Cyclone Amphan</div>
            </div>
            <span class="year-pill">2020</span>
        </div>
        <p class="history-desc">A powerful and catastrophic tropical cyclone that caused widespread damage in Eastern India and Bangladesh amid the COVID-19 pandemic lockdowns.</p>
        <div class="history-stats">
            <div class="stat-box"><span>Affected Areas</span> <b>West Bengal, Odisha</b></div>
            <div class="stat-box"><span>Category</span> <b style="color:var(--warning)">Super Cyclonic Storm</b></div>
        </div>
    </div>

    <div class="history-card">
        <div class="history-header">
            <div>
                <div class="history-title"><i class="fa-solid fa-mountain-city" style="color:var(--accent); margin-right:5px;"></i> Wayanad Landslides</div>
            </div>
            <span class="year-pill">2024</span>
        </div>
        <p class="history-desc">Severe and unprecedented landslides triggered by extreme rainfall events, displacing thousands and causing major infrastructural collapse in hilly terrains.</p>
        <div class="history-stats">
            <div class="stat-box"><span>Affected Areas</span> <b>Kerala (Wayanad)</b></div>
            <div class="stat-box"><span>Primary Cause</span> <b style="color:var(--warning)">Extreme Rainfall</b></div>
        </div>
    </div>
</div>

<div id="page-awareness" class="page">
    <div class="awareness-card">
        <i class="fa-solid fa-house-flood-water"></i>
        <h4>Flood Safety</h4>
        <div class="awareness-section">
            <h5>Before</h5>
            <ul>
                <li>Identify high ground and evacuation routes.</li>
                <li>Keep an emergency kit with 3 days of supplies.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>During</h5>
            <ul>
                <li>Move to higher floors; do not use elevators.</li>
                <li>Avoid walking/driving through flood waters.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>After</h5>
            <ul>
                <li>Watch for snakes and water-borne insects.</li>
                <li>Disinfect everything that got wet.</li>
            </ul>
        </div>
    </div>

    <div class="awareness-card">
        <i class="fa-solid fa-wind"></i>
        <h4>Cyclone Safety</h4>
        <div class="awareness-section">
            <h5>Before</h5>
            <ul>
                <li>Board up windows and secure loose objects.</li>
                <li>Trim tree branches near power lines.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>During</h5>
            <ul>
                <li>Stay indoors; keep away from glass windows.</li>
                <li>Stay in the strongest part of the building.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>After</h5>
            <ul>
                <li>Do not touch loose electrical wires.</li>
                <li>Wait for official "all clear" before going out.</li>
            </ul>
        </div>
    </div>

    <div class="awareness-card">
        <i class="fa-solid fa-burst"></i>
        <h4>Earthquake Safety</h4>
        <div class="awareness-section">
            <h5>Before</h5>
            <ul>
                <li>Secure heavy furniture to walls.</li>
                <li>Identify safe spots in every room.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>During</h5>
            <ul>
                <li>Drop, Cover, and Hold On under a sturdy table.</li>
                <li>If outside, move to an open area away from buildings.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>After</h5>
            <ul>
                <li>Prepare for aftershocks.</li>
                <li>Check for gas leaks and fire hazards.</li>
            </ul>
        </div>
    </div>

    <div class="awareness-card">
        <i class="fa-solid fa-temperature-high"></i>
        <h4>Heatwave Safety</h4>
        <div class="awareness-section">
            <h5>Before</h5>
            <ul>
                <li>Install window reflectors or dark curtains.</li>
                <li>Check cooling systems functionality.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>During</h5>
            <ul>
                <li>Drink water frequently, even if not thirsty.</li>
                <li>Avoid heavy physical work during peak sun.</li>
            </ul>
        </div>
        <div class="awareness-section">
            <h5>After</h5>
            <ul>
                <li>Check on elderly neighbors and children.</li>
                <li>Keep pets in shaded areas with water.</li>
            </ul>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// CLOCK ENGINE
setInterval(() => {
    document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-IN');
}, 1000);

// NAVIGATION SPA LOGIC
function showPage(pageId, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    el.classList.add('active');
    
    if(pageId === 'page-analytics') initCharts();
    if(pageId === 'page-home') setTimeout(() => map.invalidateSize(), 200);
}

// ---------------- MAP INITIALIZATION & BOUNDS ----------------
const indiaBounds = [
    [6.5546079, 68.1113787], // Southwest coordinates
    [35.6745457, 97.395561]  // Northeast coordinates
];

const map = L.map('map', {
    zoomControl: false,
    maxBounds: indiaBounds,
    maxBoundsViscosity: 1.0,
    minZoom: 4
}).setView([20.5937, 78.9629], 5);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

// ---------------- DATA MODELS ----------------
const states = ["Odisha", "Assam", "West Bengal", "Kerala", "Gujarat"];

// Map state names to exact coordinates
const stateCoordinates = {
    "Odisha": [20.9517, 85.0985],
    "Assam": [26.2006, 92.9376],
    "West Bengal": [22.9868, 87.8550],
    "Kerala": [10.8505, 76.2711],
    "Gujarat": [22.2587, 71.1924]
};

// Custom animated warning icon
const warningIcon = L.divIcon({
    html: '<i class="fa-solid fa-triangle-exclamation fa-beat" style="color: #ef4444; font-size: 24px; filter: drop-shadow(0px 0px 8px rgba(239, 68, 68, 0.8));"></i>',
    className: 'custom-warning-icon',
    iconSize: [24, 24],
    iconAnchor: [12, 12],
    popupAnchor: [0, -12]
});

// Add pulsing warning markers to the map for active threat states
states.forEach(stateName => {
    const coords = stateCoordinates[stateName];
    if (coords) {
        L.marker(coords, { icon: warningIcon })
            .addTo(map)
            .bindPopup(`<b style="color: #ef4444;">${stateName}</b><br>Severe Alert Protocol Active`);
    }
});

const weatherData = [
    { name: "Andhra Pradesh", temp: 31, rain: 15, wind: "14 km/h", pattern: "Easterly", hum: "60%", vis: "8km", aqi: 72 },
    { name: "Arunachal Pradesh", temp: 18, rain: 45, wind: "10 km/h", pattern: "Mountain Breeze", hum: "80%", vis: "4km", aqi: 32 },
    { name: "Assam", temp: 24, rain: 88, wind: "18 km/h", pattern: "NE Monsoon", hum: "92%", vis: "2km", aqi: 48 },
    { name: "Bihar", temp: 26, rain: 10, wind: "8 km/h", pattern: "Variable", hum: "65%", vis: "5km", aqi: 195 },
    { name: "Chhattisgarh", temp: 29, rain: 5, wind: "12 km/h", pattern: "Calm", hum: "55%", vis: "7km", aqi: 110 },
    { name: "Goa", temp: 31, rain: 0, wind: "15 km/h", pattern: "Coastal Breeze", hum: "65%", vis: "10km", aqi: 45 },
    { name: "Gujarat", temp: 34, rain: 0, wind: "20 km/h", pattern: "North-Westerly", hum: "45%", vis: "10km", aqi: 110 },
    { name: "Haryana", temp: 27, rain: 2, wind: "10 km/h", pattern: "Westerly", hum: "40%", vis: "3km", aqi: 280 },
    { name: "Himachal Pradesh", temp: 12, rain: 30, wind: "8 km/h", pattern: "Mountainous", hum: "50%", vis: "6km", aqi: 40 },
    { name: "Jharkhand", temp: 27, rain: 10, wind: "12 km/h", pattern: "Easterly", hum: "55%", vis: "7km", aqi: 130 },
    { name: "Karnataka", temp: 30, rain: 5, wind: "16 km/h", pattern: "Westerly", hum: "60%", vis: "9km", aqi: 85 },
    { name: "Kerala", temp: 30, rain: 65, wind: "22 km/h", pattern: "SW Current", hum: "85%", vis: "6km", aqi: 42 },
    { name: "Madhya Pradesh", temp: 31, rain: 0, wind: "12 km/h", pattern: "Variable", hum: "40%", vis: "8km", aqi: 125 },
    { name: "Maharashtra", temp: 32, rain: 5, wind: "15 km/h", pattern: "Coastal Breeze", hum: "55%", vis: "9km", aqi: 105 },
    { name: "Manipur", temp: 22, rain: 40, wind: "10 km/h", pattern: "Easterly", hum: "75%", vis: "5km", aqi: 55 },
    { name: "Meghalaya", temp: 20, rain: 70, wind: "14 km/h", pattern: "NE Trades", hum: "90%", vis: "3km", aqi: 38 },
    { name: "Mizoram", temp: 21, rain: 35, wind: "12 km/h", pattern: "Variable", hum: "80%", vis: "5km", aqi: 44 },
    { name: "Nagaland", temp: 19, rain: 50, wind: "10 km/h", pattern: "Mountainous", hum: "82%", vis: "4km", aqi: 50 },
    { name: "Odisha", temp: 30, rain: 20, wind: "18 km/h", pattern: "Cyclonic", hum: "78%", vis: "6km", aqi: 70 },
    { name: "Punjab", temp: 26, rain: 5, wind: "12 km/h", pattern: "Westerly", hum: "45%", vis: "4km", aqi: 210 },
    { name: "Rajasthan", temp: 35, rain: 0, wind: "22 km/h", pattern: "Dry Westerly", hum: "25%", vis: "10km", aqi: 150 },
    { name: "Sikkim", temp: 10, rain: 55, wind: "8 km/h", pattern: "Himalayan", hum: "88%", vis: "2km", aqi: 30 },
    { name: "Tamil Nadu", temp: 33, rain: 20, wind: "16 km/h", pattern: "NE Trades", hum: "70%", vis: "8km", aqi: 88 },
    { name: "Telangana", temp: 32, rain: 5, wind: "14 km/h", pattern: "Easterly", hum: "50%", vis: "9km", aqi: 92 },
    { name: "Tripura", temp: 25, rain: 50, wind: "12 km/h", pattern: "Variable", hum: "80%", vis: "5km", aqi: 62 },
    { name: "Uttar Pradesh", temp: 27, rain: 8, wind: "10 km/h", pattern: "Calm", hum: "50%", vis: "3km", aqi: 240 },
    { name: "Uttarakhand", temp: 14, rain: 25, wind: "12 km/h", pattern: "Valley Breeze", hum: "60%", vis: "5km", aqi: 80 },
    { name: "West Bengal", temp: 28, rain: 15, wind: "14 km/h", pattern: "Nor'wester", hum: "75%", vis: "7km", aqi: 145 },
    { name: "Andaman & Nicobar", temp: 29, rain: 60, wind: "25 km/h", pattern: "Tropical", hum: "85%", vis: "8km", aqi: 25 },
    { name: "Chandigarh", temp: 26, rain: 5, wind: "10 km/h", pattern: "Westerly", hum: "40%", vis: "5km", aqi: 160 },
    { name: "D&N Haveli and Daman & Diu", temp: 30, rain: 0, wind: "15 km/h", pattern: "Coastal", hum: "50%", vis: "10km", aqi: 95 },
    { name: "Delhi (NCT)", temp: 28, rain: 2, wind: "12 km/h", pattern: "Westerly", hum: "40%", vis: "1.5km", aqi: 340 },
    { name: "Jammu & Kashmir", temp: 8, rain: 40, wind: "10 km/h", pattern: "Cold Wave", hum: "70%", vis: "4km", aqi: 65 },
    { name: "Ladakh", temp: -2, rain: 10, wind: "20 km/h", pattern: "High Altitude", hum: "30%", vis: "10km", aqi: 20 },
    { name: "Lakshadweep", temp: 30, rain: 20, wind: "18 km/h", pattern: "Marine", hum: "80%", vis: "10km", aqi: 30 },
    { name: "Puducherry", temp: 32, rain: 15, wind: "14 km/h", pattern: "Easterly", hum: "70%", vis: "9km", aqi: 60 }
];

const zonalRescueData = [
    { zone: "North India", teams: 12, evacuated: "1,200", camps: 15, assets: 12, risk: "Medium" },
    { zone: "South India", teams: 8, evacuated: "4,500", camps: 28, assets: 18, risk: "High" },
    { zone: "East India", teams: 15, evacuated: "6,100", camps: 32, assets: 24, risk: "Critical" },
    { zone: "West India", teams: 4, evacuated: "450", camps: 5, assets: 6, risk: "Low" },
    { zone: "Central India", teams: 3, evacuated: "230", camps: 5, assets: 4, risk: "Low" }
];

function populateWeatherTable() {
    const tableBody = document.getElementById('weather-body');
    if(!tableBody) return;
    tableBody.innerHTML = ''; 
    const sortedData = [...weatherData].sort((a, b) => a.name.localeCompare(b.name));
    sortedData.forEach(s => {
        let aqiClass = s.aqi <= 100 ? 'aqi-good' : (s.aqi <= 200 ? 'aqi-mod' : 'aqi-poor');
        let rainColor = s.rain > 50 ? 'var(--danger)' : 'white';
        tableBody.innerHTML += `
            <tr>
                <td><b>${s.name}</b></td>
                <td>${s.temp}°C</td>
                <td style="color:${rainColor}; font-weight:bold;">${s.rain}%</td>
                <td>${s.wind}</td>
                <td style="font-size:0.75rem; color:var(--accent)">${s.pattern}</td>
                <td>${s.hum}</td>
                <td>${s.vis}</td>
                <td><span class="aqi-pill ${aqiClass}">${s.aqi}</span></td>
            </tr>`;
    });
}

function populateUI() {
    const list = document.getElementById('state-list');
    const table = document.getElementById('directory-body');
    const feed = document.getElementById('incident-feed');
    const rescueTable = document.getElementById('rescue-zonal-body');

    states.forEach(s => {
        list.innerHTML += `<div class="state-card"><b>${s}</b>: Severe Alert Protocol Active</div>`;
    });

    const allStateContacts = [
    ["Andhra Pradesh","+91-8662410978"],
    ["Arunachal Pradesh","+91-3602212299"],
    ["Assam","+91-3612237219"],
    ["Bihar","+91-6122294204"],
    ["Chhattisgarh","+91-7712223471"],
    ["Goa","+91-8322428494"],
    ["Gujarat","+91-7923251900"],
    ["Haryana","+91-1722719396"],
    ["Himachal Pradesh","+91-1772629439"],
    ["Jharkhand","+91-6512490036"],
    ["Karnataka","+91-8022340676"],
    ["Kerala","+91-4712364424"],
    ["Madhya Pradesh","+91-7552550351"],
    ["Maharashtra","+91-2222027990"],
    ["Manipur","+91-3852451550"],
    ["Meghalaya","+91-3642502094"],
    ["Mizoram","+91-3892317145"],
    ["Nagaland","+91-3702291120"],
    ["Odisha","+91-6742395398"],
    ["Punjab","+91-1722741803"],
    ["Rajasthan","+91-1412225624"],
    ["Sikkim","+91-3592202233"],
    ["Tamil Nadu","+91-4428593990"],
    ["Telangana","+91-4023454045"],
    ["Tripura","+91-3812416040"],
    ["Uttar Pradesh","+91-5222239415"],
    ["Uttarakhand","+91-1352710334"],
    ["West Bengal","+91-3322143526"],
    ["Andaman & Nicobar","+91-3192232102"],
    ["Chandigarh","+91-1722741803"],
    ["Dadra & Nagar Haveli and Daman & Diu","+91-2602230636"],
    ["Delhi (NCT)","+91-1123379181"],
    ["Jammu & Kashmir","+91-1912474159"],
    ["Ladakh","+91-1982252095"],
    ["Lakshadweep","+91-4896262256"],
    ["Puducherry","+91-4132201256"]
    ];

    allStateContacts.forEach(s => {
        table.innerHTML += `
            <tr>
                <td>${s[0]}</td>
                <td>${s[1]}</td>
                <td style="color:var(--success)">ONLINE</td>
            </tr>`;
    });

    populateWeatherTable();

    feed.innerHTML = `
        <div class="state-card" style="border-left-color:var(--danger)"><b>URGENT:</b> Cyclone landfall predicted within 24hrs.</div>
        <div class="state-card"><b>NOTICE:</b> Brahmaputra water levels rising at Dibrugarh.</div>
        <div class="state-card" style="border-left-color:var(--warning)"><b>ALRT:</b> Seismic activity detected in Himalayan foothills.</div>
    `;

    zonalRescueData.forEach(z => {
        const rColor = z.risk === 'Critical' ? 'var(--danger)' : (z.risk === 'High' ? 'var(--warning)' : 'var(--success)');
        rescueTable.innerHTML += `
            <tr>
                <td><b>${z.zone}</b></td>
                <td>${z.teams} Teams</td>
                <td>${z.evacuated}</td>
                <td>${z.camps}</td>
                <td>${z.assets} Units</td>
                <td style="color:${rColor}; font-weight:700;">${z.risk}</td>
            </tr>`;
    });

    document.getElementById('supply-feed').innerHTML = `
        <div class="state-card"><b>Air Drop:</b> Medicine kits dropped in Wayanad.</div>
        <div class="state-card"><b>Ground:</b> 5,000 Food packets delivered to Puri.</div>`;
    
    document.getElementById('comms-status').innerHTML = `
        <div class="state-card"><b>HAM Radio:</b> Operational in North Zone.</div>
        <div class="state-card" style="border-left-color:var(--danger)"><b>Sat-Link:</b> Intermittent in East Zone.</div>`;
}

window.onload = populateUI;

let chartsCreated = false;
function initCharts() {
    if(chartsCreated) return;
    chartsCreated = true;
    const commonOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } };
    new Chart(document.getElementById('windChart'), {
        type: 'line',
        data: { labels: ['10:00', '12:00', '14:00', '16:00', '18:00'], datasets: [{ label: 'km/h', data: [45, 55, 78, 82, 75], borderColor: '#fbbf24', tension: 0.4 }] },
        options: commonOptions
    });
    new Chart(document.getElementById('riverChart'), {
        type: 'line',
        data: { labels: ['Mon', 'Tue', 'Wed', 'Thu'], datasets: [{ label: 'Meters', data: [5.2, 6.8, 8.4, 8.1], borderColor: '#38bdf8', tension: 0.4 }] },
        options: commonOptions
    });
    new Chart(document.getElementById('floodChart'), {
        type: 'bar',
        data: { labels: ['Zone A', 'Zone B', 'Zone C', 'Zone D'], datasets: [{ label: 'Depth (m)', data: [0.8, 1.7, 1.2, 0.5], backgroundColor: '#ef4444' }] },
        options: commonOptions
    });
    new Chart(document.getElementById('pressureChart'), {
        type: 'line',
        data: { labels: ['06:00', '09:00', '12:00', '15:00'], datasets: [{ label: 'hPa', data: [1005, 998, 986, 992], borderColor: '#10b981', tension: 0.4 }] },
        options: commonOptions
    });
    new Chart(document.getElementById('stormChart'), {
        type: 'bar',
        data: { labels: ['East Coast', 'West Coast', 'Andaman'], datasets: [{ label: 'Height (m)', data: [3.2, 1.1, 2.5], backgroundColor: '#38bdf8' }] },
        options: commonOptions
    });
}

// ---------------- SIREN SOUND (WEB AUDIO) ----------------
let sirenCtx = null;
let sirenOsc = null;
let sirenGain = null;
let sirenTimer = null;
let sirenSweepTimer = null;

function stopSiren() {
    try {
        if (sirenSweepTimer) { clearInterval(sirenSweepTimer); sirenSweepTimer = null; }
        if (sirenTimer) { clearTimeout(sirenTimer); sirenTimer = null; }

        if (sirenOsc) { sirenOsc.stop(); sirenOsc.disconnect(); sirenOsc = null; }
        if (sirenGain) { sirenGain.disconnect(); sirenGain = null; }

        if (sirenCtx) { sirenCtx.close(); sirenCtx = null; }
    } catch(e) { /* ignore */ }
}

function playSiren(durationMs = 8000) {
    stopSiren();

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    if (!AudioContext) return;

    sirenCtx = new AudioContext();

    sirenOsc = sirenCtx.createOscillator();
    sirenGain = sirenCtx.createGain();

    sirenOsc.type = 'sawtooth';
    sirenOsc.frequency.setValueAtTime(650, sirenCtx.currentTime);
    sirenGain.gain.setValueAtTime(0.0, sirenCtx.currentTime);

    sirenOsc.connect(sirenGain);
    sirenGain.connect(sirenCtx.destination);

    // Fade in quickly
    sirenGain.gain.linearRampToValueAtTime(0.18, sirenCtx.currentTime + 0.08);

    // Sweep frequency up/down like a siren
    let goingUp = true;
    sirenSweepTimer = setInterval(() => {
        if (!sirenCtx || !sirenOsc) return;
        const now = sirenCtx.currentTime;
        const target = goingUp ? 1050 : 650;
        sirenOsc.frequency.cancelScheduledValues(now);
        sirenOsc.frequency.linearRampToValueAtTime(target, now + 0.45);
        goingUp = !goingUp;
    }, 500);

    sirenOsc.start();

    sirenTimer = setTimeout(() => {
        // Fade out then stop
        if (sirenCtx && sirenGain) {
            const now = sirenCtx.currentTime;
            sirenGain.gain.cancelScheduledValues(now);
            sirenGain.gain.linearRampToValueAtTime(0.0, now + 0.18);
        }
        setTimeout(stopSiren, 250);
    }, durationMs);
}

function triggerSOS() {
    if(confirm("ALERT: This will broadcast a Priority-1 Emergency Signal to all National Agencies. Proceed?")) {
        playSiren(9000);
        setTimeout(() => {
            alert("Success: Emergency Broadcast transmitted to NDMA and State EOCs.");
        }, 150);
    }
}
</script>

</body>
</html>
